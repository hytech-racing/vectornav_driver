<?xml version="1.0" encoding="UTF-8"?>

<!--for testing im going to make a single packet that has two 8 bit integers in it and a 15 character string -->

<!-- for the vectornav lib: -->
<!-- what I am thinking is that there is a single message that has the numeric id equal to the sync byte -->
<!-- there will be a single message with 3 sets for the the groups / group fields and there will be a lot of optional values. -->
<schema name="vectornav" endian="little">
    <fields>
        <bundle name="ang_rad_bundle">
            <float name="ang_rad_s1" type="float"/>
            <float name="ang_rad_s2" type="float"/>
            <float name="ang_rad_s3" type="float"/>
        </bundle>
    </fields>
    
    <message name="vectornav_msg" id="0xFA">
        
        <set name="groups" type="uint8">
            <bit name="general_purpose" idx="0" />
            <bit name="time_and_event_count" idx="1" />
            <bit name="inertial_measurement_unit" idx="2" />
            <bit name="gps_1" idx="3" /> 
            <bit name="AHRS" idx="4" /> 
            <bit name="INS" idx="5" /> 
            <bit name="gps_2" idx="6" /> 
            <bit name="reserved" idx="7" reserved="true"> 
                <defaultValue value="false" />
                <reservedValue value="false" />
            </bit>
        </set>

        <optional name="bg1_cond" defaultMode="missing" cond="$groups.general_purpose">
        <!-- <field> -->
            <set name="bg1" type="uint16">
                <bit name = "TimeStartup" idx="0" />
                <bit name = "TimeGps" idx="1" />
                <bit name = "TimeSyncIn" idx="2" />
                <bit name = "Ypr" idx="3" />
                <bit name = "Qtn" idx="4" />
                <bit name = "AngularRate" idx="5" />
                <bit name = "Position" idx="6" />
                <bit name = "Velocity" idx="7" />
                <bit name = "Accel" idx="8" />
                <bit name = "Imu" idx="9" />
                <bit name = "MagPres" idx="10" />
                <bit name = "DeltaTheta" idx="11" />
                <bit name = "InsStatus" idx="12" />
                <bit name = "SyncInCnt" idx="13" />
                <bit name = "TimeGpsPps" idx="14" />
                <bit name = "Resv" idx="15" /> 
            </set>
            <!-- </field> -->
        </optional>
        <!-- available units: https://commschamp.github.io/commsdsl_spec/#appendix-units -->
        <!-- <optional name="timestartup_condition" defaultMode="missing" cond="$bg1.bg1.TimeStartup">
            <int name="timestartup" type="uint64" units="ns"/> 
        </optional> -->
        
        <!-- <optional name="timegps_condition" defaultMode="missing" cond="$gf1_condition.bg1.TimeGps"> -->
            <!-- <int name="timegps" type="uint64" units="ns"/>  -->
        <!-- </optional> -->
        <!-- <optional name="TimeSyncIn_condition" defaultMode="missing" cond="$gf1_condition.bg1.TimeSyncIn"> -->
            <!-- <int name="TimeSyncIn" type="uint64" units="ns"/>  --> -->
        <!-- </optional> -->
        <!-- <optional name="ypr_condition" defaultMode="missing" cond="$gf1_condition.bg1.Ypr">
            <float name="yaw" type="float" units="deg"/>
            <float name="pitch" type="float" units="deg"/>
            <float name="roll" type="float" units="deg"/>
        </optional>
        <optional name="quaternion_condition" defaultMode="missing" cond="$gf1_condition.bg1.Qtn">
            <float name="atitude_quat_q1" type="float"/>
            <float name="atitude_quat_q2" type="float"/>
            <float name="atitude_quat_q3" type="float"/>
            <float name="atitude_quat_q4" type="float"/>
        </optional> -->

        <!-- <optional name="angularrate_condition" defaultMode="missing" cond="$gf1_condition.bg1.AngularRate">
            <bundle name="ang_rad_fields" reuse="ang_rad_bundle"/>
        </optional> -->
        <!-- <optional name="position_condition" defaultMode="missing" cond="$gf1_condition.bg1.Position">
            <float name="latitude" type="double" units="deg"/>
            <float name="longitude" type="double" units="deg"/>
            <float name="altitude" type="double" units="m"/>
        </optional>
        <optional name="vel_condition" defaultMode="missing" cond="$gf1_condition.bg1.Velocity">
            <float name="vel_ned_1" type="float" units="m/s"/>
            <float name="vel_ned_2" type="float" units="m/s"/>
            <float name="vel_ned_3" type="float" units="m/s"/>
        </optional>
        <optional name="accel_condition" defaultMode="missing" cond="$gf1_condition.bg1.Accel">
            <float name="accel_ned_1" type="float"/>
            <float name="accel_ned_2" type="float"/>
            <float name="accel_ned_3" type="float"/>
        </optional>
        <optional name="imu_condition" defaultMode="missing" cond="$gf1_condition.bg1.Imu">
            <float name="imu_accel_1" type="float"/>
            <float name="imu_accel_2" type="float"/>
            <float name="imu_accel_3" type="float"/>
            <float name="imu_rate_1" type="float"/>
            <float name="imu_rate_2" type="float"/>
            <float name="imu_rate_3" type="float"/>
        </optional> -->
        <!-- TimeStartup 0 Time since startup.
TimeGps 1 GPS time.
TimeSyncIn 2 Time since last SyncIn trigger.
Ypr 3 Estimated attitude as yaw pitch and roll angles.
Qtn 4 Estimated attitude as a quaternion.
AngularRate 5 Compensated angular rate.
Position 6 Estimated position. (LLA)
Velocity 7 Estimated velocity. (NED)
Accel 8 Estimated acceleration (compensated). (Body)
Imu 9 Calibrated uncompensated gyro and accelerometer
measurements.
MagPres 10 Calibrated magnetic (compensated), temperature,
and pressure measurements.
DeltaTheta 11 Delta time, theta, and velocity.
InsStatus 12 INS status.
SyncInCnt 13 SyncIn count.
TimeGpsPps 14 Time since last GPS PPS trigger.
Resv 15 Reserved for future use. Should be set to zero. -->
        <!-- <set name="groups field 2" type="uint16">
            <bit name="general_purpose" idx="0" />
            <bit name="time_and_event_count" idx="1" />
            <bit name="inertial_measurement_unit" idx="2" />
            <bit name="gps_1" idx="3" /> 
            <bit name="AHRS" idx="4" /> 
            <bit name="INS" idx="5" /> 
            <bit name="gps_2" idx="6" /> 
            <bit name="reserved" idx="7" reserved="true"> 
                <defaultValue value="false" />
                <reservedValue value="false" />
            </bit>
        </set> -->
    </message>
    <frame name="frame">
        <id name="Id">
            <int name="IdField" type="uint8" />
        </id>
        <payload name="Data" />
        <checksum name="Checksum" alg="crc-16" from="Data">
            <int name="ChecksumField" type="uint16" />
        </checksum>
    </frame>
</schema>